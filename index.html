<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Words Learning Game 🎮</title>
</head>
<body>
    <div id="wordsGameApp" class="wga-container">
        <style>
            /* Scoped styles - only affect elements inside #wordsGameApp */
            #wordsGameApp {
                /* Container isolation */
                all: initial;
                font-family: 'Comic Sans MS', cursive, sans-serif !important;
                display: block;
                width: 100%;
                max-width: 100%;
                box-sizing: border-box;
                position: relative;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                padding: 20px;
                border-radius: 20px;
                margin: 0 auto;
            }

            #wordsGameApp * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            #wordsGameApp .wga-inner-container {
                background: rgba(255, 255, 255, 0.95);
                border-radius: 30px;
                padding: 30px;
                width: 100%;
                max-width: 900px;
                margin: 0 auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            }

            #wordsGameApp .wga-title {
                text-align: center;
                color: #764ba2;
                font-size: 2.5em;
                margin-bottom: 20px;
                font-weight: bold;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
                animation: wga-rainbow 3s ease-in-out infinite;
                line-height: 1.2;
            }

            @keyframes wga-rainbow {
                0%, 100% { color: #764ba2; }
                25% { color: #f093fb; }
                50% { color: #4facfe; }
                75% { color: #43e97b; }
            }

            #wordsGameApp .wga-input-section {
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                padding: 20px;
                border-radius: 20px;
                margin-bottom: 20px;
            }

            #wordsGameApp .wga-words-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 10px;
                margin-bottom: 20px;
            }

            #wordsGameApp .wga-word-input {
                padding: 10px;
                border: 3px solid #fff;
                border-radius: 15px;
                font-size: 1.1em;
                background: rgba(255, 255, 255, 0.9);
                transition: all 0.3s;
                width: 100%;
                font-family: inherit;
            }

            #wordsGameApp .wga-word-input:focus {
                transform: scale(1.05);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
                outline: none;
            }

            #wordsGameApp .wga-button-group {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
                justify-content: center;
                margin: 20px 0;
            }

            #wordsGameApp .wga-button {
                padding: 12px 25px;
                font-size: 1em;
                border: none;
                border-radius: 25px;
                cursor: pointer;
                transition: all 0.3s;
                font-weight: bold;
                text-transform: uppercase;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
                font-family: inherit;
                display: inline-block;
            }

            #wordsGameApp .wga-button:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            }

            #wordsGameApp .wga-button:disabled {
                opacity: 0.5;
                cursor: not-allowed;
                transform: none;
            }

            #wordsGameApp .wga-start-btn {
                background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
                color: white;
            }

            #wordsGameApp .wga-random-btn {
                background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
                color: white;
            }

            #wordsGameApp .wga-clear-btn {
                background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
                color: white;
            }

            #wordsGameApp .wga-end-btn {
                background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                color: white;
            }

            #wordsGameApp .wga-game-section {
                display: none;
            }

            #wordsGameApp .wga-hint-card {
                background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
                padding: 20px;
                border-radius: 20px;
                margin-bottom: 20px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            }

            #wordsGameApp .wga-hint {
                font-size: 1.2em;
                margin: 10px 0;
                padding: 10px;
                background: white;
                border-radius: 10px;
                border-left: 5px solid #4facfe;
                line-height: 1.4;
            }

            #wordsGameApp .wga-answer-input {
                padding: 15px;
                font-size: 1.3em;
                border: 3px solid #4facfe;
                border-radius: 15px;
                width: 100%;
                margin: 10px 0;
                text-align: center;
                transition: all 0.3s;
                font-family: inherit;
            }

            #wordsGameApp .wga-answer-input:focus {
                border-color: #43e97b;
                transform: scale(1.05);
                outline: none;
            }

            #wordsGameApp .wga-score-board {
                background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
                color: white;
                padding: 20px;
                border-radius: 20px;
                text-align: center;
                font-size: 1.3em;
                margin: 20px 0;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            }

            #wordsGameApp .wga-score {
                font-size: 1.8em;
                font-weight: bold;
                display: inline-block;
                animation: wga-pulse 1s infinite;
            }

            @keyframes wga-pulse {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.1); }
            }

            #wordsGameApp .wga-celebration {
                display: none;
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                text-align: center;
                z-index: 999999;
                background: white;
                padding: 40px;
                border-radius: 30px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            }

            #wordsGameApp .wga-trophy {
                font-size: 80px;
                animation: wga-bounce 1s infinite;
                display: block;
                line-height: 1;
            }

            @keyframes wga-bounce {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-20px); }
            }

            #wordsGameApp .wga-feedback {
                font-size: 1.2em;
                padding: 10px;
                border-radius: 10px;
                margin: 10px 0;
                text-align: center;
                font-weight: bold;
            }

            #wordsGameApp .wga-correct {
                background: #43e97b;
                color: white;
                animation: wga-correctAnimation 0.5s;
            }

            #wordsGameApp .wga-incorrect {
                background: #ff6b6b;
                color: white;
                animation: wga-shake 0.5s;
            }

            @keyframes wga-correctAnimation {
                0% { transform: scale(0.8); }
                50% { transform: scale(1.2); }
                100% { transform: scale(1); }
            }

            @keyframes wga-shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-10px); }
                75% { transform: translateX(10px); }
            }

            #wordsGameApp .wga-speak-btn {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
            }

            #wordsGameApp .wga-api-key-section {
                background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
                padding: 20px;
                border-radius: 20px;
                margin-bottom: 20px;
            }

            #wordsGameApp .wga-api-input {
                width: 100%;
                padding: 10px;
                border: 2px solid #fcb69f;
                border-radius: 10px;
                font-size: 1em;
                margin-top: 10px;
                font-family: inherit;
            }

            #wordsGameApp .wga-info-box {
                background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
                color: white;
                padding: 15px;
                border-radius: 15px;
                margin: 10px 0;
                text-align: center;
                font-size: 1em;
                line-height: 1.4;
            }

            #wordsGameApp .wga-category-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 10px;
                margin: 20px 0;
            }

            #wordsGameApp .wga-category-btn {
                padding: 10px;
                background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
                border: none;
                border-radius: 15px;
                cursor: pointer;
                font-size: 0.95em;
                transition: all 0.3s;
                color: #764ba2;
                font-weight: bold;
                font-family: inherit;
            }

            #wordsGameApp .wga-category-btn:hover {
                transform: scale(1.05);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            }

            #wordsGameApp .wga-loading {
                text-align: center;
                padding: 20px;
                font-size: 1.1em;
                color: #764ba2;
            }

            #wordsGameApp .wga-spinner {
                display: inline-block;
                width: 40px;
                height: 40px;
                border: 4px solid #f3f3f3;
                border-top: 4px solid #764ba2;
                border-radius: 50%;
                animation: wga-spin 1s linear infinite;
                margin: 20px auto;
            }

            @keyframes wga-spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }

            #wordsGameApp .wga-h2 {
                color: white;
                text-align: center;
                margin-bottom: 20px;
                font-size: 1.5em;
                font-weight: bold;
            }

            #wordsGameApp .wga-h3 {
                color: #764ba2;
                margin-bottom: 15px;
                font-size: 1.3em;
                font-weight: bold;
            }
        </style>

        <div class="wga-inner-container">
            <h1 class="wga-title">🌟 Words Learning Game 🌟</h1>

            <div class="wga-input-section">
                <h2 class="wga-h2">📝 Inserisci da 1 a 10 parole in inglese</h2>
                <div class="wga-words-grid">
                    <input type="text" class="wga-word-input" placeholder="Word 1 (required)">
                    <input type="text" class="wga-word-input" placeholder="Word 2 (optional)">
                    <input type="text" class="wga-word-input" placeholder="Word 3 (optional)">
                    <input type="text" class="wga-word-input" placeholder="Word 4 (optional)">
                    <input type="text" class="wga-word-input" placeholder="Word 5 (optional)">
                    <input type="text" class="wga-word-input" placeholder="Word 6 (optional)">
                    <input type="text" class="wga-word-input" placeholder="Word 7 (optional)">
                    <input type="text" class="wga-word-input" placeholder="Word 8 (optional)">
                    <input type="text" class="wga-word-input" placeholder="Word 9 (optional)">
                    <input type="text" class="wga-word-input" placeholder="Word 10 (optional)">
                </div>
                
                <div style="margin: 20px 0;">
                    <h3 class="wga-h3" style="color: white; text-align: center; margin-bottom: 10px;">🎲 Oppure scegli una categoria:</h3>
                    <div class="wga-category-grid">
                        <button class="wga-category-btn" onclick="wgaInsertCategoryWords('animals')">🦁 Animals</button>
                        <button class="wga-category-btn" onclick="wgaInsertCategoryWords('food')">🍕 Food</button>
                        <button class="wga-category-btn" onclick="wgaInsertCategoryWords('school')">📚 School</button>
                        <button class="wga-category-btn" onclick="wgaInsertCategoryWords('colors')">🎨 Colors</button>
                        <button class="wga-category-btn" onclick="wgaInsertCategoryWords('emotions')">😊 Emotions</button>
                        <button class="wga-category-btn" onclick="wgaInsertCategoryWords('actions')">🏃 Actions</button>
                        <button class="wga-category-btn" onclick="wgaInsertCategoryWords('nature')">🌳 Nature</button>
                        <button class="wga-category-btn" onclick="wgaInsertCategoryWords('transport')">🚗 Transport</button>
                    </div>
                </div>

                <div class="wga-button-group">
                    <button class="wga-button wga-start-btn" onclick="wgaStartGame()">🎮 Start Game</button>
                    <button class="wga-button wga-random-btn" onclick="wgaInsertRandomWords()">🎲 Random Mix</button>
                    <button class="wga-button wga-clear-btn" onclick="wgaClearAll()">🧹 Clear All</button>
                </div>
            </div>

            <div class="wga-game-section" id="wgaGameSection">
                <div class="wga-score-board">
                    <div>🏆 Score: <span class="wga-score" id="wgaScore">0</span></div>
                    <div>📍 Question: <span id="wgaCurrentQuestion">1 of 1</span></div>
                </div>

                <div class="wga-hint-card" id="wgaHintCard">
                    <h3 class="wga-h3">💡 Suggerimenti:</h3>
                    <div id="wgaHints">
                        <div class="wga-loading" id="wgaLoadingHints" style="display: none;">
                            <div class="wga-spinner"></div>
                            Generating hints...
                        </div>
                    </div>
                    <input type="text" class="wga-answer-input" id="wgaAnswerInput" placeholder="Scrivi la parola qui..." onkeypress="wgaCheckEnter(event)">
                    <div style="text-align: center;">
                        <button class="wga-button wga-start-btn" onclick="wgaCheckAnswer()" id="wgaCheckBtn">✅ Check Answer</button>
                        <button class="wga-button wga-speak-btn" onclick="wgaSpeakWord()">🔊 Pronuncia</button>
                    </div>
                    <div id="wgaFeedback"></div>
                </div>

                <div class="wga-button-group">
                    <button class="wga-button wga-end-btn" onclick="wgaEndGame()">🔚 End Game</button>
                </div>
            </div>

            <div class="wga-celebration" id="wgaCelebration">
                <div class="wga-trophy">🏆</div>
                <h2 style="color: #764ba2;">CONGRATULAZIONI!</h2>
                <p style="font-size: 1.3em; margin: 20px 0;">Hai vinto! Sei un campione!</p>
                <button class="wga-button wga-start-btn" onclick="wgaCloseCelebration()">Gioca Ancora</button>
            </div>
        </div>
    </div>

    <script>
        // Namespace all variables to avoid conflicts
        (function() {
            let wgaWords = [];
            let wgaCurrentWordIndex = 0;
            let wgaScore = 0;
            let wgaCurrentWord = '';

            const wgaWordCategories = {
                animals: ['elephant', 'giraffe', 'penguin', 'kangaroo', 'dolphin', 'octopus', 'butterfly', 'crocodile', 'hamster', 'peacock'],
                food: ['pizza', 'hamburger', 'spaghetti', 'sandwich', 'chocolate', 'vegetables', 'breakfast', 'restaurant', 'delicious', 'recipe'],
                school: ['mathematics', 'geography', 'homework', 'classroom', 'dictionary', 'education', 'library', 'computer', 'science', 'history'],
                colors: ['turquoise', 'magenta', 'crimson', 'lavender', 'emerald', 'sapphire', 'golden', 'silver', 'rainbow', 'colorful'],
                emotions: ['excited', 'nervous', 'confident', 'surprised', 'grateful', 'curious', 'peaceful', 'frustrated', 'delighted', 'worried'],
                actions: ['explore', 'discover', 'imagine', 'celebrate', 'remember', 'practice', 'achieve', 'create', 'understand', 'communicate'],
                nature: ['mountain', 'ocean', 'forest', 'desert', 'waterfall', 'volcano', 'island', 'canyon', 'glacier', 'meadow'],
                transport: ['airplane', 'helicopter', 'submarine', 'motorcycle', 'skateboard', 'elevator', 'spaceship', 'ambulance', 'tractor', 'scooter']
            };

            window.wgaInsertCategoryWords = function(category) {
                const categoryWords = wgaWordCategories[category];
                const inputs = document.querySelectorAll('#wordsGameApp .wga-word-input');
                inputs.forEach((input, index) => {
                    input.value = categoryWords[index];
                });
            }

            window.wgaInsertRandomWords = function() {
                const allWords = Object.values(wgaWordCategories).flat();
                const randomWords = [];
                
                for (let i = 0; i < 10; i++) {
                    const randomWord = allWords[Math.floor(Math.random() * allWords.length)];
                    randomWords.push(randomWord);
                }
                
                const inputs = document.querySelectorAll('#wordsGameApp .wga-word-input');
                inputs.forEach((input, index) => {
                    input.value = randomWords[index];
                });
            }

            window.wgaClearAll = function() {
                const inputs = document.querySelectorAll('#wordsGameApp .wga-word-input');
                inputs.forEach(input => input.value = '');
                wgaEndGame();
            }

            window.wgaStartGame = async function() {
                wgaWords = [];
                const inputs = document.querySelectorAll('#wordsGameApp .wga-word-input');
                inputs.forEach(input => {
                    if (input.value.trim()) {
                        wgaWords.push(input.value.trim().toLowerCase());
                    }
                });

                if (wgaWords.length === 0) {
                    alert('⚠️ Per favore inserisci almeno una parola per iniziare!');
                    return;
                }

                document.querySelector('#wordsGameApp .wga-input-section').style.display = 'none';
                document.getElementById('wgaGameSection').style.display = 'block';
                
                wgaCurrentWordIndex = 0;
                wgaScore = 0;
                wgaUpdateScore();
                wgaUpdateQuestionCounter();
                await wgaLoadNextWord();
            }

            window.wgaUpdateQuestionCounter = function() {
                const questionText = document.getElementById('wgaCurrentQuestion');
                if (questionText) {
                    questionText.textContent = `${wgaCurrentWordIndex + 1} of ${wgaWords.length}`;
                }
            }

            window.wgaLoadNextWord = async function() {
                if (wgaCurrentWordIndex >= wgaWords.length) {
                    wgaShowGameSummary();
                    return;
                }

                wgaCurrentWord = wgaWords[wgaCurrentWordIndex];
                wgaUpdateQuestionCounter();
                document.getElementById('wgaAnswerInput').value = '';
                document.getElementById('wgaFeedback').innerHTML = '';
                document.getElementById('wgaCheckBtn').disabled = false;

                await wgaGenerateHints(wgaCurrentWord);
            }

            window.wgaGenerateHints = async function(word) {
                const hintsContainer = document.getElementById('wgaHints');
                const loadingDiv = document.getElementById('wgaLoadingHints');
                
                loadingDiv.style.display = 'block';
                hintsContainer.innerHTML = '';
                
                try {
                    console.log('Calling endpoint with word:', word);
                    
                    // Usa l'endpoint sicuro del server WordPress
                    const response = await fetch('https://www.robertozanoni.it/wp-json/gemini/v1/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            prompt: `Crea suggerimenti pertinenti per aiutare un bambino di 7 anni a indovinare la parola "${word}".

# Steps
1. Comprensione della Parola: Analizza "${word}" per comprenderne il significato e le caratteristiche principali.
2. Creazione di Suggerimenti: Sviluppa 3 suggerimenti che siano:
   - Semplici: Usa un linguaggio adatto a un bambino di 7 anni
   - Descrittivi: Evidenzia le caratteristiche principali della parola
   - Associativi: Usa esempi o associazioni che il bambino potrebbe conoscere
3. IMPORTANTE: Sostituisci SEMPRE la parola "${word}" con "..." in ogni frase

# Output Format
Fornisci esattamente 3 suggerimenti separati da punto e virgola (;)
Ogni suggerimento deve essere una frase breve (massimo 10 parole)
La parola "${word}" DEVE essere sostituita con "..." in ogni frase

# Examples
Input: "cat"
Output: The ... says meow and purrs; A ... has whiskers and a tail; Dogs often chase the ...

Input: "tree"
Output: Birds build nests in the ...; The ... has leaves and branches; We get wood from a ...

# Notes
- Assicurati che i suggerimenti siano adatti all'età del bambino
- Evita termini troppo tecnici o complessi
- Usa esempi della vita quotidiana del bambino
- SEMPRE sostituisci "${word}" con "..." nei suggerimenti

Genera ora 3 suggerimenti per la parola "${word}":`
                        })
                    });

                    console.log('Response status:', response.status);
                    loadingDiv.style.display = 'none';

                    if (response.ok) {
                        const data = await response.json();
                        console.log('Response data:', data);
                        
                        // Gestisce diversi formati di risposta possibili
                        let text = '';
                        if (data && data.text) {
                            text = data.text;
                        } else if (data && data.response) {
                            text = data.response;
                        } else if (data && data.content) {
                            text = data.content;
                        } else if (data && data.result) {
                            text = data.result;
                        } else if (data && data.data) {
                            text = data.data;
                        } else if (typeof data === 'string') {
                            text = data;
                        } else {
                            console.error('Unknown response format:', data);
                            throw new Error('Unknown response format');
                        }
                        
                        console.log('Extracted text:', text);
                        
                        if (text) {
                            // Parse dei suggerimenti
                            let hints = text.split(';').map(h => h.trim()).filter(h => h.length > 0);
                            
                            // Se non ci sono punti e virgola, prova con newlines
                            if (hints.length <= 1) {
                                hints = text.split('\n').map(h => h.trim()).filter(h => h.length > 0 && h.includes('...'));
                            }
                            
                            console.log('Parsed hints:', hints);
                            
                            if (hints.length > 0) {
                                const emojis = ['🌟', '💡', '✨'];
                                hintsContainer.innerHTML = hints.slice(0, 3).map((hint, index) => 
                                    `<div class="wga-hint">${emojis[index]} ${hint}</div>`
                                ).join('');
                            } else {
                                throw new Error('No hints in response');
                            }
                        } else {
                            throw new Error('Empty response text');
                        }
                    } else {
                        const errorText = await response.text();
                        console.error('Server error:', response.status, errorText);
                        throw new Error(`Server error: ${response.status}`);
                    }
                } catch (error) {
                    console.error('Error generating hints:', error);
                    loadingDiv.style.display = 'none';
                    
                    // Mostra messaggio di errore
                    hintsContainer.innerHTML = `
                        <div style="background: #ffebee; color: #c62828; padding: 15px; border-radius: 10px; margin: 10px 0;">
                            ⚠️ Errore nel generare suggerimenti. Uso suggerimenti di base.
                        </div>
                    `;
                    
                    // Fallback hints migliorati
                    const fallbackHints = wgaGenerateSmartFallbackHints(word);
                    
                    hintsContainer.innerHTML += fallbackHints.map((hint, index) => 
                        `<div class="wga-hint">📌 ${hint}</div>`
                    ).join('');
                }
            }

            window.wgaGenerateSmartFallbackHints = function(word) {
                const hints = [];
                const wordLength = word.length;
                const firstLetter = word[0].toUpperCase();
                const vowels = ['a', 'e', 'i', 'o', 'u'];
                const vowelCount = word.toLowerCase().split('').filter(char => vowels.includes(char)).length;
                
                // Hint 1: Prima lettera e lunghezza
                hints.push(`The ... starts with '${firstLetter}' and has ${wordLength} letters`);
                
                // Hint 2: Pattern vocali/consonanti
                if (vowelCount > 0) {
                    hints.push(`The ... has ${vowelCount} vowel${vowelCount > 1 ? 's' : ''} in it`);
                } else {
                    hints.push(`The ... has only consonants (unusual!)`);
                }
                
                // Hint 3: Pattern finale della parola
                if (word.endsWith('ing')) {
                    hints.push(`The ... is an action word ending in -ing`);
                } else if (word.endsWith('ed')) {
                    hints.push(`The ... ends with -ed (past tense)`);
                } else if (word.endsWith('ly')) {
                    hints.push(`The ... ends with -ly (describes how)`);
                } else if (word.endsWith('er')) {
                    hints.push(`The ... ends with -er (person or comparison)`);
                } else if (word.endsWith('est')) {
                    hints.push(`The ... ends with -est (superlative)`);
                } else if (word.endsWith('s')) {
                    hints.push(`The ... ends with the letter 's'`);
                } else {
                    const lastTwo = word.slice(-2);
                    hints.push(`The ... ends with '${lastTwo}'`);
                }
                
                return hints;
            }

            window.wgaCheckEnter = function(event) {
                if (event.key === 'Enter') {
                    wgaCheckAnswer();
                }
            }

            window.wgaCheckAnswer = function() {
                const answer = document.getElementById('wgaAnswerInput').value.trim().toLowerCase();
                const feedbackDiv = document.getElementById('wgaFeedback');
                
                if (!answer) return;
                
                document.getElementById('wgaCheckBtn').disabled = true;
                
                if (answer === wgaCurrentWord) {
                    wgaScore++;
                    feedbackDiv.innerHTML = '<div class="wga-feedback wga-correct">✨ CORRETTO! Bravissimo! ✨</div>';
                    
                    setTimeout(() => {
                        wgaCurrentWordIndex++;
                        wgaLoadNextWord();
                    }, 2000);
                } else {
                    feedbackDiv.innerHTML = `<div class="wga-feedback wga-incorrect">❌ La parola corretta è: <strong>${wgaCurrentWord}</strong></div>`;
                    
                    setTimeout(() => {
                        wgaCurrentWordIndex++;
                        wgaLoadNextWord();
                    }, 3000);
                }
                
                wgaUpdateScore();
            }

            window.wgaUpdateScore = function() {
                document.getElementById('wgaScore').textContent = wgaScore;
            }

            window.wgaSpeakWord = function() {
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(wgaCurrentWord);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.7;
                    utterance.pitch = 1.1;
                    speechSynthesis.speak(utterance);
                }
            }

            window.wgaShowGameSummary = function() {
                const percentage = Math.round((wgaScore / wgaWords.length) * 100);
                const feedbackDiv = document.getElementById('wgaHintCard');
                
                let message = '';
                let emoji = '';
                
                if (percentage === 100) {
                    emoji = '🏆';
                    message = 'PERFETTO! Sei un campione!';
                    if (wgaWords.length >= 10) {
                        document.getElementById('wgaCelebration').style.display = 'block';
                    }
                } else if (percentage >= 80) {
                    emoji = '🌟';
                    message = 'Eccellente! Ottimo lavoro!';
                } else if (percentage >= 60) {
                    emoji = '😊';
                    message = 'Bravo! Stai migliorando!';
                } else {
                    emoji = '🎯';
                    message = 'Continua a praticare!';
                }
                
                feedbackDiv.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 80px;">${emoji}</div>
                        <h2 style="color: #764ba2; margin: 20px 0;">${message}</h2>
                        <div style="font-size: 1.3em; margin: 20px 0;">
                            Punteggio finale: <strong>${wgaScore}/${wgaWords.length}</strong> (${percentage}%)
                        </div>
                        <button class="wga-button wga-start-btn" onclick="wgaEndGame()">🎮 Gioca Ancora</button>
                    </div>
                `;
            }

            window.wgaCloseCelebration = function() {
                document.getElementById('wgaCelebration').style.display = 'none';
                wgaEndGame();
            }

            window.wgaEndGame = function() {
                document.getElementById('wgaGameSection').style.display = 'none';
                document.querySelector('#wordsGameApp .wga-input-section').style.
