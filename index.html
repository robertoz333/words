<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spelling & Riddle Game</title>
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap");
        :root {
            --bg: #f0f8ff; --text: #444; --brand: #ff69b4; --brand-dark: #d1478e;
            --title: #ff6347; --title-shadow: #ffb6c1; --accent: #ff4500;
            --ok: #2e8b57; --no: #dc143c; --next-btn-bg: #4caf50; --next-btn-shadow: #388e3c;
        }
        * { box-sizing: border-box; }
        body {
            font-family: "Fredoka One", cursive, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            text-align: center;
            padding: 20px;
        }
        #container {
            max-width: 900px; margin: 0 auto; background-color: #ffffff;
            padding: 30px; border-radius: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 5px solid #fff;
        }
        h1 { color: var(--title); font-size: 3.2em; text-shadow: 2px 2px 0px var(--title-shadow); margin-bottom: 14px; }
        p { font-size: 1.05em; color: #555; line-height: 1.5; }
        .controls { margin: 14px 0 8px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
        
        #word-input-container {
            width: 100%; padding: 10px; border-radius: 15px;
            border: 3px dashed #add8e6; margin-bottom: 8px; background-color: #f0f8ff;
            display: flex; flex-direction: column; gap: 8px;
        }
        .word-entry { display: flex; align-items: center; gap: 10px; padding: 5px; }
        .entry-number { font-weight: bold; color: var(--brand-dark); font-size: 1.1em; min-width: 25px; text-align: right; }
        .word-input-field {
            flex-grow: 1; border: none; border-bottom: 2px solid #ccc; background-color: transparent;
            font-family: "Fredoka One", cursive; font-size: 1em; outline: none; padding: 5px;
        }
        .word-input-field:focus { border-bottom-color: var(--brand); }
        
        button {
            background-color: var(--brand); color: white; padding: 12px 22px; border: none;
            border-radius: 50px; font-size: 1.1em; cursor: pointer; box-shadow: 0 4px var(--brand-dark);
            font-family: "Fredoka One", cursive;
        }
        button:active { transform: translateY(2px); box-shadow: 0 2px var(--brand-dark); }
        button.secondary { background: #eee; color: #333; box-shadow: 0 4px #ccc; }
        button.next-button {
            background-color: var(--next-btn-bg);
            box-shadow: 0 4px var(--next-btn-shadow);
        }

        #output { margin-top: 22px; text-align: left; }
        #riddle-box {
            padding: 20px; border-radius: 15px; margin-top: 20px;
            background-color: #f7faff; border-left: 10px solid var(--brand);
            min-height: 150px; /* Assicura uno spazio anche quando vuoto */
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .riddle-title {
            font-size: 1.6em; color: var(--accent); font-weight: bold; margin-bottom: 14px; text-align: center;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid var(--brand);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .clues-list {
            list-style-type: 'ðŸ‘‰ ';
            padding-left: 20px;
            text-align: left;
            margin: 10px 0;
        }
        .clues-list li {
            margin-bottom: 8px;
            font-size: 1.1em;
            color: #555;
            line-height: 1.5;
        }
        .guess-input-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .guess-input {
            padding: 8px 12px;
            font-size: 1em;
            font-family: "Fredoka One", cursive;
            border: 2px solid #ccc;
            border-radius: 10px;
            outline: none;
            text-align: center;
        }
        .guess-input.correct { border-color: var(--ok); color: var(--ok); }
        .guess-input.incorrect { border-color: var(--no); color: var(--no); }

        #helper { margin-top: 8px; font-size: .95em; color: #666; text-align: center; }
        #scoreDisplay { font-size: 1.1em; font-weight: bold; color: var(--brand-dark); margin-top: 10px; }
        #correctScoreDisplay, #wrongScoreDisplay {
            font-size: 1.1em; font-weight: bold; margin-top: 5px;
        }
        #correctScoreDisplay { color: var(--ok); }
        #wrongScoreDisplay { color: var(--no); }

        .modal {
            display: none;
            position: fixed;
            z-index: 10;
            left: 0; top: 0;
            width: 100%; height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center; align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            padding: 20px;
            border-radius: 15px;
            width: 80%; max-width: 400px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            text-align: center;
        }
        .close-button {
            color: #aaa; float: right; font-size: 28px; font-weight: bold;
            cursor: pointer;
        }
        .close-button:hover, .close-button:focus {
            color: #000; text-decoration: none; cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="container">
        <h1>ðŸŒŸ Spelling & Riddle Game ðŸŒŸ</h1>
        <p>Enter up to 10 words, then solve the riddles!</p>

        <div id="word-input-container"></div>

        <div class="controls">
            <button id="btnGenerate">Generate Riddles!</button>
            <button id="btnRandom">Generate 10 Random Words</button>
            <button class="secondary" id="btnClear">Clear</button>
        </div>

        <div id="helper" class="helper"></div>
        <div id="scoreDisplay">Session Score: 0</div>
        <div id="correctScoreDisplay">Correct Answers: 0</div>
        <div id="wrongScoreDisplay">Wrong Answers: 0</div>
        
        <div id="output">
            <div id="riddle-box">
                <div class="riddle-title">ðŸ¤” Let's Play! ðŸ¤”</div>
                <p>Add some words above and click "Generate Riddles!".</p>
            </div>
        </div>
    </div>
    
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <p id="modal-message"></p>
        </div>
    </div>

    <script>
        const MAX_WORDS = 10;
        const scoreDisplay = document.getElementById("scoreDisplay");
        const correctScoreDisplay = document.getElementById("correctScoreDisplay");
        const wrongScoreDisplay = document.getElementById("wrongScoreDisplay");
        const wordInputContainer = document.getElementById('word-input-container');
        const outputDiv = document.getElementById("output");
        const riddleBox = document.getElementById("riddle-box");
        const helper = document.getElementById("helper");
        const btnRandom = document.getElementById("btnRandom");
        
        let sessionScore = 0;
        let correctScore = 0;
        let wrongScore = 0;
        let wordsToGuess = [];
        let currentWordIndex = 0;

        // Lista di parole inglesi per il generatore random
        const wordBank = [
            "cat","dog","apple","banana","house","tree","car","book","river","sun",
            "moon","star","fish","bird","flower","train","phone","chair","cloud","cake",
            "ball","shoes","computer","mouse","desk","pen","school","street","window","door",
            "water","fire","earth","wind","love","happy","smile","friend","family","music"
        ];

        // Modale per avvisi
        const modal = document.getElementById("modal");
        const modalMessage = document.getElementById("modal-message");
        const closeButton = document.querySelector(".close-button");

        function showModal(message) {
            modalMessage.textContent = message;
            modal.style.display = "flex";
        }

        closeButton.onclick = () => {
            modal.style.display = "none";
        };

        window.onclick = (event) => {
            if (event.target === modal) {
                modal.style.display = "none";
            }
        };

        // Funzione per mescolare l'array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Genera 10 parole random diverse
        function generateRandomWords() {
            const inputs = document.querySelectorAll(".word-input-field");
            let chosen = [];
            while (chosen.length < MAX_WORDS) {
                let rndWord = wordBank[Math.floor(Math.random() * wordBank.length)];
                if (!chosen.includes(rndWord)) {
                    chosen.push(rndWord);
                }
            }
            inputs.forEach((inp, i) => { inp.value = chosen[i]; });
        }

        // ====== Logica di generazione degli indizi tramite LLM ======
        async function fetchHints(word) {
            riddleBox.innerHTML = `<div class="loading-spinner"></div>`;
            const systemPrompt = `You are a very simple riddle generator for a spelling game. Your goal is to create short, easy hints for a word, like clues for a treasure hunt. The hints must be easy for a 7-year-old to understand. Use common things and actions a child knows. Provide exactly three hints. Do NOT include the word in the hints. The hints should be a short, simple list.`;
            const userQuery = `Provide hints for the word "${word}".`;
            const apiKey = "AIzaSyAgJQxCqhqptws_ll9kd4nKH2cZwpRF_Ok"; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];
                if (candidate && candidate.content?.parts?.[0]?.text) {
                    return candidate.content.parts[0].text;
                } else {
                    throw new Error("Invalid API response format.");
                }
            } catch (error) {
                console.error("Error fetching hints:", error);
                return "I'm sorry, I couldn't generate hints for this word right now. Please try another one.";
            }
        }

        // ====== Gestione del gioco e dell'interfaccia utente ======
        async function loadNextRiddle() {
            if (currentWordIndex >= wordsToGuess.length) {
                riddleBox.innerHTML = `<div class="riddle-title">Game Over!</div><p>You have solved all the riddles!</p><p>Click "Clear" to play again.</p>`;
                return;
            }

            const currentWord = wordsToGuess[currentWordIndex];
            const hintsText = await fetchHints(currentWord);

            riddleBox.innerHTML = '';
            const title = document.createElement('div');
            title.className = 'riddle-title';
            title.textContent = 'ðŸ¤” Can you guess the word? ðŸ¤”';
            riddleBox.appendChild(title);

            const hintsList = document.createElement('ul');
            hintsList.className = 'clues-list';
            hintsText.split('\n').forEach(hint => {
                if (hint.trim().length > 0) {
                    const listItem = document.createElement('li');
                    listItem.textContent = hint.replace(/^- /, '').trim();
                    hintsList.appendChild(listItem);
                }
            });
            riddleBox.appendChild(hintsList);

            const guessContainer = document.createElement('div');
            guessContainer.className = 'guess-input-container';
            const guessInput = document.createElement('input');
            guessInput.type = 'text';
            guessInput.className = 'guess-input';
            guessInput.placeholder = 'Your guess...';
            guessInput.autocomplete = 'off';
            guessContainer.appendChild(guessInput);

            const checkButton = document.createElement('button');
            checkButton.textContent = 'Check';
            checkButton.onclick = () => checkGuess(guessInput, currentWord, checkButton);
            guessContainer.appendChild(checkButton);
            
            riddleBox.appendChild(guessContainer);
        }

        function checkGuess(guessInput, correctWord, checkButton) {
            if (guessInput.value.toLowerCase().trim() === correctWord.toLowerCase().trim()) {
                guessInput.classList.remove('incorrect');
                guessInput.classList.add('correct');
                sessionScore++;
                correctScore++;
                updateScores();
                showModal("Correct! Great job!");

                checkButton.style.display = 'none';

                const nextButton = document.createElement('button');
                nextButton.textContent = 'Next Word';
                nextButton.classList.add('next-button');
                nextButton.style.marginTop = '10px';
                nextButton.onclick = () => {
                    currentWordIndex++;
                    loadNextRiddle();
                };
                
                const guessContainer = document.querySelector('.guess-input-container');
                guessContainer.appendChild(nextButton);

            } else {
                guessInput.classList.remove('correct');
                guessInput.classList.add('incorrect');
                sessionScore--;
                wrongScore++;
                updateScores();
                showModal("Oops! That's not right. Try again!");
            }
        }

        function updateScores() {
            scoreDisplay.textContent = `Session Score: ${sessionScore}`;
            correctScoreDisplay.textContent = `Correct Answers: ${correctScore}`;
            wrongScoreDisplay.textContent = `Wrong Answers: ${wrongScore}`;
        }

        // Genera TUTTI gli indovinelli
        function generateRiddles() {
            wordsToGuess = [];
            document.querySelectorAll('.word-input-field').forEach(inp => {
                const w = inp.value.trim().toLowerCase();
                if (w) wordsToGuess.push(w);
            });
            const uniqueWords = [...new Set(wordsToGuess)];
            wordsToGuess = uniqueWords;

            shuffleArray(wordsToGuess);

            if (wordsToGuess.length === 0) {
                helper.textContent = "Please add at least one word.";
                return;
            }
            helper.textContent = `Words to guess: ${wordsToGuess.length}`;
            currentWordIndex = 0;
            sessionScore = 0;
            correctScore = 0;
            wrongScore = 0;
            updateScores();
            loadNextRiddle();
        }

        // Crea i campi input (layout originale numerato)
        function createWordInputs() {
            wordInputContainer.innerHTML = '';
            for (let i = 1; i <= MAX_WORDS; i++) {
                const entryDiv = document.createElement('div');
                entryDiv.className = 'word-entry';

                const numberSpan = document.createElement('span');
                numberSpan.className = 'entry-number';
                numberSpan.textContent = `${i}.`;
                entryDiv.appendChild(numberSpan);

                const inputField = document.createElement('input');
                inputField.type = 'text';
                inputField.className = 'word-input-field';
                inputField.placeholder = 'Type the word...';
                inputField.autocomplete = 'off';
                entryDiv.appendChild(inputField);

                wordInputContainer.appendChild(entryDiv);
            }
        }

        // Event listeners
        document.getElementById("btnGenerate").addEventListener("click", generateRiddles);
        btnRandom.addEventListener("click", generateRandomWords);
        document.getElementById("btnClear").addEventListener("click", () => {
            document.querySelectorAll('.word-input-field').forEach(inp => inp.value = '');
            riddleBox.innerHTML = `<div class="riddle-title">ðŸ¤” Let's Play! ðŸ¤”</div><p>Add some words above and click "Generate Riddles!".</p>`;
            document.getElementById("helper").textContent = "";
            sessionScore = 0;
            correctScore = 0;
            wrongScore = 0;
            currentWordIndex = 0;
            wordsToGuess = [];
            updateScores();
        });

        // Inizializzazione
        createWordInputs();
    </script>
</body>
</html>
