<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Words Learning Game</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh; padding: 20px;
    }
    .container {
      max-width: 900px; margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 30px; padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    h1 {
      text-align: center; color: #764ba2;
      font-size: 2.5em; margin-bottom: 20px;
      animation: rainbow 3s ease-in-out infinite;
    }
    @keyframes rainbow {
      0%, 100% { color: #764ba2; }
      25% { color: #f093fb; }
      50% { color: #4facfe; }
      75% { color: #43e97b; }
    }
    .input-section {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      padding: 20px; border-radius: 20px; margin-bottom: 20px;
    }
    .words-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px; margin-bottom: 20px;
    }
    .word-input {
      padding: 10px; border: 3px solid #fff; border-radius: 15px;
      font-size: 1.1em; background: rgba(255, 255, 255, 0.9);
      transition: all 0.3s;
    }
    .word-input:focus { transform: scale(1.05); outline: none; }
    .button-group {
      display: flex; gap: 10px; flex-wrap: wrap;
      justify-content: center; margin: 20px 0;
    }
    button {
      padding: 12px 25px; font-size: 1em; border: none;
      border-radius: 25px; cursor: pointer; transition: all 0.3s;
      font-weight: bold; text-transform: uppercase;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    button:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    .start-btn { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; }
    .random-btn { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; }
    .clear-btn { background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%); color: white; }
    .end-btn { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }
    .speak-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    .game-section { display: none; }
    .hint-card {
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      padding: 20px; border-radius: 20px; margin-bottom: 20px;
    }
    .hint {
      font-size: 1.2em; margin: 10px 0; padding: 10px;
      background: white; border-radius: 10px; border-left: 5px solid #4facfe;
    }
    .answer-input {
      padding: 15px; font-size: 1.3em; border: 3px solid #4facfe;
      border-radius: 15px; width: 100%; margin: 10px 0; text-align: center;
    }
    .score-board {
      background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
      color: white; padding: 20px; border-radius: 20px;
      text-align: center; font-size: 1.3em; margin: 20px 0;
    }
    .feedback {
      font-size: 1.2em; padding: 10px; border-radius: 10px;
      margin: 10px 0; text-align: center; font-weight: bold;
    }
    .correct { background: #43e97b; color: white; }
    .incorrect { background: #ff6b6b; color: white; }
    .loading { text-align: center; padding: 20px; }
    .spinner {
      display: inline-block; width: 40px; height: 40px;
      border: 4px solid #f3f3f3; border-top: 4px solid #764ba2;
      border-radius: 50%; animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .category-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px; margin: 20px 0;
    }
    .category-btn {
      padding: 10px; background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      border: none; border-radius: 15px; cursor: pointer;
      font-size: 0.9em; color: #764ba2; font-weight: bold;
    }
    .celebration {
      display: none; position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%); text-align: center; z-index: 1000;
      background: white; padding: 40px; border-radius: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    .next-btn {
      background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      color: white; padding: 12px 30px; font-size: 1.2em;
      border: none; border-radius: 25px; cursor: pointer;
      font-weight: bold; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      transition: all 0.3s; margin-top: 10px;
    }
    .next-btn:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🌟 Words Learning Game 🌟</h1>

    <!-- Input Section -->
    <div class="input-section" id="inputSection">
      <h2 style="color:white; text-align:center; margin-bottom:20px;">📝 Inserisci da 1 a 10 parole in inglese</h2>
      <div class="words-grid">
        <input type="text" class="word-input" placeholder="Word 1" id="word1">
        <input type="text" class="word-input" placeholder="Word 2" id="word2">
        <input type="text" class="word-input" placeholder="Word 3" id="word3">
        <input type="text" class="word-input" placeholder="Word 4" id="word4">
        <input type="text" class="word-input" placeholder="Word 5" id="word5">
        <input type="text" class="word-input" placeholder="Word 6" id="word6">
        <input type="text" class="word-input" placeholder="Word 7" id="word7">
        <input type="text" class="word-input" placeholder="Word 8" id="word8">
        <input type="text" class="word-input" placeholder="Word 9" id="word9">
        <input type="text" class="word-input" placeholder="Word 10" id="word10">
      </div>
      <div>
        <h3 style="color:white; text-align:center; margin:20px 0 10px;">🎲 Oppure scegli una categoria:</h3>
        <div class="category-grid">
          <button class="category-btn" id="animalsBtn">🦁 Animals</button>
          <button class="category-btn" id="foodBtn">🍕 Food</button>
          <button class="category-btn" id="schoolBtn">📚 School</button>
          <button class="category-btn" id="colorsBtn">🎨 Colors</button>
          <button class="category-btn" id="emotionsBtn">😊 Emotions</button>
          <button class="category-btn" id="actionsBtn">🏃 Actions</button>
          <button class="category-btn" id="natureBtn">🌳 Nature</button>
          <button class="category-btn" id="transportBtn">🚗 Transport</button>
        </div>
      </div>
      <div class="button-group">
        <button class="start-btn" id="startBtn">🎮 Start Game</button>
        <button class="random-btn" id="randomBtn">🎲 Random Mix</button>
        <button class="clear-btn" id="clearBtn">🧹 Clear All</button>
      </div>
    </div>

    <!-- Game Section -->
    <div class="game-section" id="gameSection">
      <div class="score-board">
        <div>🏆 Score: <span id="score">0</span></div>
        <div>📍 Question: <span id="currentQuestion">1</span> of <span id="totalQuestions">10</span></div>
      </div>
      <div class="hint-card">
        <h3 style="color:#764ba2; margin-bottom:15px;">💡 Suggerimenti:</h3>
        <div id="hints">
          <div class="loading" id="loadingHints" style="display:none;">
            <div class="spinner"></div>
            <p>Generating hints...</p>
          </div>
        </div>
        <input type="text" class="answer-input" id="answerInput" placeholder="Scrivi la parola qui...">
        <div style="text-align:center;">
          <button class="start-btn" id="checkBtn">✅ Check Answer</button>
          <button class="speak-btn" id="speakBtn">🔊 Pronuncia</button>
        </div>
        <div id="feedback"></div>
      </div>
      <div class="button-group">
        <button class="end-btn" id="endBtn">🔚 End Game</button>
      </div>
    </div>

    <!-- Celebration -->
    <div class="celebration" id="celebration">
      <div class="trophy">🏆</div>
      <h2 style="color:#764ba2;">CONGRATULAZIONI!</h2>
      <p style="font-size:1.3em; margin:20px 0;">Hai vinto! Sei un campione!</p>
      <button class="start-btn" id="closeCelebrationBtn">Gioca Ancora</button>
    </div>
  </div>

  <script>
    let words = [], currentWordIndex = 0, score = 0, currentWord = '';

    const categories = {
      animals: ['cat','dog','elephant','lion','tiger','bear','monkey','zebra','giraffe','penguin'],
      food: ['pizza','pasta','bread','cheese','apple','banana','carrot','cookie','sandwich','juice'],
      school: ['book','pencil','teacher','desk','computer','homework','backpack','library','student','classroom'],
      colors: ['red','blue','green','yellow','purple','orange','pink','black','white','brown'],
      emotions: ['happy','sad','angry','excited','tired','scared','surprised','proud','nervous','calm'],
      actions: ['run','jump','walk','swim','dance','sing','play','read','write','draw'],
      nature: ['tree','flower','mountain','river','ocean','forest','desert','cloud','rain','sun'],
      transport: ['car','bus','train','airplane','bicycle','boat','helicopter','motorcycle','truck','subway']
    };

    // Event listeners
    document.getElementById('startBtn').addEventListener('click', startGame);
    document.getElementById('randomBtn').addEventListener('click', insertRandomWords);
    document.getElementById('clearBtn').addEventListener('click', clearAll);
    document.getElementById('checkBtn').addEventListener('click', checkAnswer);
    document.getElementById('speakBtn').addEventListener('click', speakWord);
    document.getElementById('endBtn').addEventListener('click', endGame);
    document.getElementById('closeCelebrationBtn').addEventListener('click', closeCelebration);

    document.getElementById('animalsBtn').addEventListener('click', () => insertCategory('animals'));
    document.getElementById('foodBtn').addEventListener('click', () => insertCategory('food'));
    document.getElementById('schoolBtn').addEventListener('click', () => insertCategory('school'));
    document.getElementById('colorsBtn').addEventListener('click', () => insertCategory('colors'));
    document.getElementById('emotionsBtn').addEventListener('click', () => insertCategory('emotions'));
    document.getElementById('actionsBtn').addEventListener('click', () => insertCategory('actions'));
    document.getElementById('natureBtn').addEventListener('click', () => insertCategory('nature'));
    document.getElementById('transportBtn').addEventListener('click', () => insertCategory('transport'));

    document.getElementById('answerInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') checkAnswer();
    });

    function insertCategory(category) {
      const catWords = categories[category];
      for (let i = 1; i <= 10; i++) {
        document.getElementById(`word${i}`).value = catWords[i-1] || '';
      }
    }

    function insertRandomWords() {
      const allWords = Object.values(categories).flat();
      for (let i = 1; i <= 10; i++) {
        const randomWord = allWords[Math.floor(Math.random() * allWords.length)];
        document.getElementById(`word${i}`).value = randomWord;
      }
    }

    function clearAll() {
      for (let i = 1; i <= 10; i++) {
        document.getElementById(`word${i}`).value = '';
      }
    }

    async function startGame() {
      words = [];
      for (let i = 1; i <= 10; i++) {
        const value = document.getElementById(`word${i}`).value.trim();
        if (value) words.push(value.toLowerCase());
      }
      if (words.length === 0) {
        alert('Per favore inserisci almeno una parola!');
        return;
      }
      document.getElementById('inputSection').style.display = 'none';
      document.getElementById('gameSection').style.display = 'block';
      document.getElementById('totalQuestions').textContent = words.length;
      currentWordIndex = 0; score = 0;
      updateScore(); await loadNextWord();
    }

    async function loadNextWord() {
      if (currentWordIndex >= words.length) { showGameSummary(); return; }
      currentWord = words[currentWordIndex];
      document.getElementById('currentQuestion').textContent = currentWordIndex + 1;
      document.getElementById('answerInput').value = '';
      document.getElementById('answerInput').disabled = false;
      document.getElementById('checkBtn').disabled = false;
      document.getElementById('feedback').innerHTML = '';
      document.getElementById('answerInput').focus();
      await generateHints(currentWord);
    }

// ✅ Funzione con payload corretto per Gemini
    async function generateHints(word) {
      const hintsDiv = document.getElementById('hints');
      const loadingDiv = document.getElementById('loadingHints');
      loadingDiv.style.display = 'block'; hintsDiv.innerHTML = '';
      try {
        // --- MODIFICA FONDAMENTALE QUI ---
        // Sostituisci l'URL qui sotto con l'indirizzo del TUO sito WordPress.
        const response = await fetch('https://[INDIRIZZO_DEL_TUO_SITO_WORDPRESS]/wp-json/gemini/v1/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [
              {
                parts: [
                  { text: `Give me 6 clues for the word "${word}" without using the word itself.` }
                ]
              }
            ]
          })
        });
        if (!response.ok) throw new Error(`API error: ${response.status}`);
        const data = await response.json();
        console.log("Gemini API RAW:", data);

        // funzione ricorsiva che trova la prima stringa
        function findFirstString(obj) {
          if (!obj) return null;
          if (typeof obj === "string" && obj.trim().length > 0) return obj;
          if (typeof obj === "object") {
            for (let key in obj) {
              const val = findFirstString(obj[key]);
              if (val) return val;
            }
          }
          return null;
        }

        let text = findFirstString(data);

        if (!text) {
          hintsDiv.innerHTML = `
            <div style="background:#fff3cd; color:#856404; padding:15px; border-radius:10px;">
              ⚠️ Nessun testo trovato, ecco il JSON crudo:
            </div>
            <pre style="font-size:0.8em; background:#eee; padding:10px;">${JSON.stringify(data, null, 2)}</pre>
          `;
          return;
        }

        let clues = [];
        if (text.includes("\n")) clues = text.split("\n");
        else if (text.includes(". ")) clues = text.split(". ");
        else clues = [text];

        clues = clues.map(c => c.trim())
                     .filter(c => c.length > 3 && !c.toLowerCase().includes(word.toLowerCase()));

        if (clues.length > 0) {
          const emojis = ['🔍','👀','✨','💡','🎯','⭐'];
          hintsDiv.innerHTML = clues.slice(0, 6).map((clue, i) =>
            `<div class="hint">${emojis[i] || '💡'} ${clue}</div>`
          ).join('');
        } else { throw new Error("No valid clues extracted"); }

      } catch (err) {
        console.error("Error generating hints:", err);
        hintsDiv.innerHTML = `
          <div style="background:#fff3cd; color:#856404; padding:15px; border-radius:10px; margin:10px 0;">
            ⚠️ Problema temporaneo con i suggerimenti.<br>Riprova o contatta l'amministratore.
          </div>
          <div class="hint">🔍 Pensa a cosa potrebbe essere questa parola</div>
          <div class="hint">👀 È una parola inglese importante</div>
        `;
      } finally { loadingDiv.style.display = 'none'; }
    }

    function checkAnswer() {
      const answer = document.getElementById('answerInput').value.trim().toLowerCase();
      const feedbackDiv = document.getElementById('feedback');
      if (!answer) return;
      if (answer === currentWord) {
        score++;
        feedbackDiv.innerHTML = `<div class="feedback correct">✨ CORRETTO! Bravissimo! ✨<br>La parola era: <strong>${currentWord}</strong></div>
          <div style="text-align:center;margin-top:15px;"><button class="next-btn" id="nextBtn">➡️ NEXT</button></div>`;
      } else {
        feedbackDiv.innerHTML = `<div class="feedback incorrect">❌ Non esatto. La parola corretta è: <strong>${currentWord}</strong></div>
          <div style="text-align:center;margin-top:15px;"><button class="next-btn" id="nextBtn">➡️ NEXT</button></div>`;
      }
      document.getElementById('checkBtn').disabled = true;
      document.getElementById('answerInput').disabled = true;
      document.getElementById('nextBtn').onclick = ()=>{ currentWordIndex++; loadNextWord(); };
      updateScore();
    }

    function updateScore(){ document.getElementById('score').textContent = score; }

    function speakWord() {
      if ('speechSynthesis' in window) {
        speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(currentWord);
        utterance.lang = 'en-US'; utterance.rate = 0.8;
        speechSynthesis.speak(utterance);
      }
    }

    function showGameSummary() {
      const percentage = Math.round((score/words.length)*100);
      const hintsDiv = document.getElementById('hints');
      let emoji = percentage===100?'🏆':percentage>=80?'🌟':percentage>=60?'😊':'🎯';
      let message = percentage===100?'PERFETTO!':percentage>=80?'Eccellente!':percentage>=60?'Bravo!':'Continua!';
      hintsDiv.innerHTML = `<div style="text-align:center;padding:40px;"><div style="font-size:80px;">${emoji}</div>
        <h2 style="color:#764ba2;">${message}</h2><p style="font-size:1.3em;">Score: ${score}/${words.length} (${percentage}%)</p></div>`;
      document.getElementById('answerInput').style.display='none';
      document.getElementById('checkBtn').style.display='none';
      document.getElementById('speakBtn').style.display='none';
      if (percentage===100 && words.length>=10){ setTimeout(()=>{document.getElementById('celebration').style.display='block';},500);}
    }

    function closeCelebration(){ document.getElementById('celebration').style.display='none'; endGame(); }
    function endGame() {
      document.getElementById('gameSection').style.display='none';
      document.getElementById('inputSection').style.display='block';
      document.getElementById('answerInput').style.display='block';
      document.getElementById('checkBtn').style.display='inline-block';
      document.getElementById('speakBtn').style.display='inline-block';
      currentWordIndex=0; score=0;
    }
  </script>
</body>
</html>
